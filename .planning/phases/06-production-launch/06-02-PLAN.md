---
phase: 06-production-launch
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified: []
autonomous: false
user_setup:
  - service: stripe
    why: "Production payment processing"
    env_vars:
      - name: STRIPE_SECRET_KEY
        source: "Stripe Dashboard -> Developers -> API keys -> Secret key (live mode, NOT test mode)"
      - name: NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
        source: "Stripe Dashboard -> Developers -> API keys -> Publishable key (live mode)"
      - name: STRIPE_WEBHOOK_SECRET
        source: "Stripe Dashboard -> Developers -> Webhooks -> Add endpoint -> use production URL https://jamaicahousebrand.com/api/webhooks/stripe -> copy signing secret"
    dashboard_config:
      - task: "Create production webhook endpoint"
        location: "Stripe Dashboard -> Developers -> Webhooks -> Add endpoint"
        details: "URL: https://jamaicahousebrand.com/api/webhooks/stripe | Events: checkout.session.completed"
  - service: google-analytics
    why: "Production analytics tracking"
    env_vars:
      - name: NEXT_PUBLIC_GA_MEASUREMENT_ID
        source: "Google Analytics -> Admin -> Data Streams -> Web -> Measurement ID (starts with G-)"
  - service: meta-pixel
    why: "Facebook/Instagram ad conversion tracking"
    env_vars:
      - name: NEXT_PUBLIC_META_PIXEL_ID
        source: "Meta Events Manager -> Data Sources -> select your Pixel -> Pixel ID (numeric)"
  - service: domain-registrar
    why: "DNS configuration to point jamaicahousebrand.com to Vercel"
    dashboard_config:
      - task: "Configure DNS records"
        location: "Your domain registrar (GoDaddy, Namecheap, Cloudflare, etc.)"
        details: "Add A record: @ -> 76.76.21.21 | Add CNAME record: www -> cname.vercel-dns.com"

must_haves:
  truths:
    - "Production Stripe keys are configured on Vercel (not test keys)"
    - "GA4 measurement ID is set for production"
    - "Meta Pixel ID is set for production"
    - "Custom domain jamaicahousebrand.com is added to Vercel project"
    - "DNS points jamaicahousebrand.com to Vercel"
    - "SSL certificate is active (HTTPS works)"
    - "Production build deploys successfully with all env vars"
  artifacts:
    - path: "Vercel Environment Variables (remote)"
      provides: "Production secrets for Stripe, GA4, Meta Pixel"
      contains: "STRIPE_SECRET_KEY, NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY, STRIPE_WEBHOOK_SECRET, NEXT_PUBLIC_GA_MEASUREMENT_ID, NEXT_PUBLIC_META_PIXEL_ID"
  key_links:
    - from: "Vercel env vars"
      to: "src/lib/stripe.ts"
      via: "process.env.STRIPE_SECRET_KEY"
      pattern: "STRIPE_SECRET_KEY"
    - from: "Vercel env vars"
      to: "src/components/analytics/GoogleAnalytics.tsx"
      via: "process.env.NEXT_PUBLIC_GA_MEASUREMENT_ID"
      pattern: "NEXT_PUBLIC_GA_MEASUREMENT_ID"
    - from: "Vercel env vars"
      to: "src/components/analytics/MetaPixel.tsx"
      via: "process.env.NEXT_PUBLIC_META_PIXEL_ID"
      pattern: "NEXT_PUBLIC_META_PIXEL_ID"
    - from: "DNS A record"
      to: "Vercel deployment"
      via: "76.76.21.21"
      pattern: "jamaicahousebrand.com"
---

<objective>
Configure production environment variables, add custom domain, and deploy to production.

Purpose: Transition from preview deployment to live production site at jamaicahousebrand.com with real Stripe payment processing and analytics tracking.
Output: Production deployment accessible at https://jamaicahousebrand.com with working payments and analytics.
</objective>

<execution_context>
@/Users/rfmstaff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rfmstaff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/rfmstaff/Desktop/jamaica-house-brand/.planning/phases/06-production-launch/06-01-SUMMARY.md
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/lib/stripe.ts
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/components/analytics/GoogleAnalytics.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/components/analytics/MetaPixel.tsx
@/Users/rfmstaff/Desktop/jamaica-house-brand/src/app/api/webhooks/stripe/route.ts
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Provide production API keys and service IDs</name>
  <action>
    Claude cannot access your Stripe dashboard, Google Analytics, or Meta Events Manager. You need to provide the following production values.
  </action>
  <instructions>
    Please provide the following values. Claude will configure them on Vercel.

    **1. Stripe Production Keys** (Stripe Dashboard -> toggle OFF "Test mode" -> Developers -> API keys):
    - `STRIPE_SECRET_KEY`: starts with `sk_live_...`
    - `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`: starts with `pk_live_...`

    **2. Stripe Webhook** (do this AFTER the domain is added in Task 3):
    - Go to Stripe Dashboard -> Developers -> Webhooks -> "Add endpoint"
    - Endpoint URL: `https://jamaicahousebrand.com/api/webhooks/stripe`
    - Events to listen for: `checkout.session.completed`
    - Copy the "Signing secret" (starts with `whsec_...`)
    - `STRIPE_WEBHOOK_SECRET`: the signing secret you just copied

    **3. Google Analytics 4** (analytics.google.com -> Admin -> Data Streams -> your web stream):
    - `NEXT_PUBLIC_GA_MEASUREMENT_ID`: starts with `G-...`
    - If you don't have a GA4 property yet, create one at analytics.google.com

    **4. Meta Pixel** (business.facebook.com -> Events Manager -> Data Sources):
    - `NEXT_PUBLIC_META_PIXEL_ID`: numeric ID
    - If you don't have a Pixel yet, create one in Meta Events Manager

    Provide each value and Claude will configure them. If any service is not ready yet, say "skip" for that one and we'll add it later.
  </instructions>
  <resume-signal>Provide the values above, or type "skip [service]" for any you want to configure later.</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Set production environment variables on Vercel and add custom domain</name>
  <files></files>
  <action>
    Using the values provided by the user in Task 1:

    1. Set each environment variable on Vercel for the production environment:
       ```
       vercel env add STRIPE_SECRET_KEY production
       vercel env add NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY production
       vercel env add STRIPE_WEBHOOK_SECRET production
       vercel env add NEXT_PUBLIC_GA_MEASUREMENT_ID production
       vercel env add NEXT_PUBLIC_META_PIXEL_ID production
       ```
       For any skipped services, do NOT set those variables.

    2. Add custom domain to Vercel project:
       ```
       vercel domains add jamaicahousebrand.com
       ```
       Also add www subdomain:
       ```
       vercel domains add www.jamaicahousebrand.com
       ```

    3. Trigger a production deployment with the new env vars:
       ```
       cd /Users/rfmstaff/Desktop/jamaica-house-brand && vercel --prod --yes
       ```

    4. Check the domain configuration status:
       ```
       vercel domains inspect jamaicahousebrand.com
       ```

    IMPORTANT: NEXT_PUBLIC_ variables are embedded at build time. The production deployment in step 3 MUST happen AFTER setting env vars in step 1, or the client-side analytics will not have the correct IDs.
  </action>
  <verify>Run `vercel env ls` and confirm all provided env vars are listed for production. Run `vercel domains ls` and confirm jamaicahousebrand.com appears. Run `vercel ls` and confirm a production deployment exists.</verify>
  <done>All production env vars are set on Vercel. Custom domain is added. A production build has been deployed with the correct env vars baked in.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 3: Configure DNS at your domain registrar</name>
  <action>
    Claude cannot access your domain registrar. You need to configure DNS records.
  </action>
  <instructions>
    Go to your domain registrar (GoDaddy, Namecheap, Cloudflare, etc.) and configure the following DNS records for jamaicahousebrand.com:

    **Option A: A Record (recommended)**
    | Type | Name | Value |
    |------|------|-------|
    | A | @ | 76.76.21.21 |
    | CNAME | www | cname.vercel-dns.com |

    **Option B: Nameservers (alternative, gives Vercel full DNS control)**
    Set nameservers to:
    - ns1.vercel-dns.com
    - ns2.vercel-dns.com

    After configuring, DNS propagation typically takes 5-30 minutes (sometimes up to 48 hours, but usually fast).

    You can check propagation status at: https://dnschecker.org/#A/jamaicahousebrand.com
  </instructions>
  <resume-signal>Type "DNS configured" when you've updated the records, or share your registrar name if you need specific instructions.</resume-signal>
</task>

</tasks>

<verification>
- `vercel env ls` shows STRIPE_SECRET_KEY, NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY, STRIPE_WEBHOOK_SECRET (if not skipped), NEXT_PUBLIC_GA_MEASUREMENT_ID (if not skipped), NEXT_PUBLIC_META_PIXEL_ID (if not skipped) for production scope
- `vercel domains ls` shows jamaicahousebrand.com
- `curl -s -o /dev/null -w "%{http_code}" https://jamaicahousebrand.com` returns 200 (after DNS propagation)
- `curl -sI https://jamaicahousebrand.com | grep -i strict-transport-security` confirms HTTPS/SSL is active
</verification>

<success_criteria>
Production deployment is live at https://jamaicahousebrand.com with SSL, production Stripe keys configured, and analytics IDs set. DNS resolves correctly.
</success_criteria>

<output>
After completion, create `.planning/phases/06-production-launch/06-02-SUMMARY.md`
</output>
